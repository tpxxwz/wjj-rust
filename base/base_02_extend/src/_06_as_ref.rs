/*
===============================================================
ğŸ§  AsRef<T> â€”â€” Rust æ ‡å‡†åº“ä¸­çš„é›¶æˆæœ¬å€Ÿç”¨è½¬æ¢ trait
===============================================================

AsRef<T> çš„æ ¸å¿ƒä½œç”¨ï¼š
    âœ” æŠŠ &Self è½¬æ¢æˆ &T
    âœ” ä¸å¤åˆ¶ã€ä¸åˆ†é…ã€ä¸åˆ›å»ºæ–°å¯¹è±¡ï¼ˆzeroâ€‘costï¼‰
    âœ” å¸¸ç”¨äºç»Ÿä¸€ API è¾“å…¥ç±»å‹

---------------------------------------------------------------
ğŸ“Œ ä¸ºä»€ä¹ˆéœ€è¦ AsRefï¼Ÿ
---------------------------------------------------------------
å¦‚æœä½ å†™ä¸€ä¸ªå‡½æ•°ï¼Œå¸Œæœ›å®ƒèƒ½åŒæ—¶æ¥å—ï¼š
    - &str
    - String
    - è‡ªå®šä¹‰ç±»å‹ï¼ˆä¾‹å¦‚ FilePathï¼‰
ä½ ä¸æƒ³å†™å¤šä¸ªé‡è½½ï¼š

    fn foo_str(s: &str) {}
    fn foo_string(s: &String) {}

ä½ å¯ä»¥å†™æˆï¼š

    fn foo<S: AsRef<str>>(s: S) {}

è¿™æ ·ï¼š
    foo("abc");
    foo(String::from("abc"));
    foo(FilePath("abc".into()));

å…¨éƒ¨éƒ½èƒ½ç”¨ã€‚

---------------------------------------------------------------
ğŸ“Œ AsRef vs Into vs Borrowï¼ˆå·¥ç¨‹å¸ˆå¿…æ‡‚ï¼‰
---------------------------------------------------------------
AsRef<T>ï¼š
    - &Self â†’ &T
    - ä¸æ¶ˆè€—æ‰€æœ‰æƒ
    - ä¸å¤åˆ¶ã€ä¸åˆ†é…
    - æœ€å¸¸ç”¨äºå‡½æ•°å‚æ•°

Into<T>ï¼š
    - Self â†’ T
    - ä¼šæ¶ˆè€—æ‰€æœ‰æƒ
    - å¯èƒ½åˆ†é…æˆ–å¤åˆ¶

Borrow<T>ï¼š
    - ç”¨äºé›†åˆï¼ˆHashMap/HashSetï¼‰å†…éƒ¨å€Ÿç”¨è§„åˆ™
    - è¯­ä¹‰æ›´å¼ºï¼Œä¸ç”¨äºä¸€èˆ¬ API

---------------------------------------------------------------
ğŸ“Œ Demo è¯´æ˜
---------------------------------------------------------------
æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªè‡ªå®šä¹‰ç±»å‹ FilePathï¼Œ
ä¸ºå®ƒå®ç° AsRef<str>ï¼Œ
è¿™æ ·å®ƒå°±èƒ½åƒ &str ä¸€æ ·ä¼ ç»™ç»Ÿä¸€çš„ APIã€‚

ä¸‹é¢æ˜¯å®Œæ•´å¯è¿è¡Œçš„ #[test] ç¤ºä¾‹ã€‚
===============================================================
*/

use std::fmt;

// è‡ªå®šä¹‰ç±»å‹ï¼šå†…éƒ¨æŒæœ‰ä¸€ä¸ª String
struct FilePath(String);

// ä¸º FilePath å®ç° AsRef<str>
impl AsRef<str> for FilePath {
    fn as_ref(&self) -> &str {
        &self.0
    }
}

// ä¸€ä¸ªæ¥å— AsRef<str> çš„å‡½æ•°
fn print_path<P: AsRef<str>>(p: P) -> String {
    format!("path = {}", p.as_ref())
}

#[test]
fn demo_as_ref() {
    let p = FilePath("assets/config.json".into());

    // FilePath å®ç°äº† AsRef<str>ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ä¼ å…¥
    let out = print_path(&p);
    println!("{}", out);

    // ä¹Ÿå¯ä»¥ä¼ å…¥ &str
    let out2 = print_path("assets/readme.md");
    println!("{}", out2);

    // ä¹Ÿå¯ä»¥ä¼ å…¥ String
    let out3 = print_path(String::from("assets/data.bin"));
    println!("{}", out3);
}
